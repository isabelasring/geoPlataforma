<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Proyectos Ciudades - GeoPlataforma</title>
    <script>(function(){var t=localStorage.getItem('geoPlataforma-theme');if(t==='dark')document.documentElement.setAttribute('data-theme','dark');})();</script>
    <link rel="stylesheet" href="../css/index.css">
    <link rel="stylesheet" href="../css/ciudades-proyectos.css">
</head>
<body>

    <nav class="navbar scrolled" id="navbar">
        <div class="nav-container">
            <a href="index.html" class="logo">
                <img src="../img%3Avideo/isologo-01.png" alt="GeoPlataforma" class="logo-img">
            </a>
            <ul class="nav-links" id="nav-links">
                <li><a href="index.html">Inicio</a></li>
                <li class="nav-dropdown nav-dropdown-servicios">
                    <button type="button" class="nav-dropdown-toggle" aria-expanded="false" aria-haspopup="true">Servicios</button>
                    <ul class="nav-dropdown-menu nav-dropdown-menu-servicios">
                        <li class="nav-dropdown-item-with-panel">
                            <a href="ciudades.html">Ciudades</a>
                            <div class="nav-services-panel nav-panel-ciudades" aria-hidden="true">
                                <span class="nav-panel-label">Servicios en Ciudades</span>
                                <a href="ciudades.html#servicio-iot">IoT</a>
                                <a href="ciudades.html#servicio-mapas-ruido">Mapas de ruido</a>
                                <a href="ciudades.html#servicio-webgis">Ecosistemas WEBGIS</a>
                                <a href="ciudades.html#servicio-descontaminacion">Planes de descontaminación acústica</a>
                                <a href="ciudades.html#servicio-geoespacial">Analítica geoespacial</a>
                            </div>
                        </li>
                        <li class="nav-dropdown-item-with-panel">
                            <a href="industria.html">Industria</a>
                            <div class="nav-services-panel nav-panel-industria" aria-hidden="true">
                                <span class="nav-panel-label">Servicios en Industria</span>
                                <a href="industria.html#servicio-iot">IoT</a>
                                <a href="industria.html#servicio-control-ruido">Control de ruido</a>
                                <a href="industria.html#servicio-clasificacion-fuentes">Clasificación de fuentes</a>
                                <a href="industria.html#servicio-modelacion-ruido">Modelación de ruido</a>
                                <a href="industria.html#servicio-holografia-acustica">Holografía acústica</a>
                                <a href="industria.html#servicio-medicion-vibraciones">Medición de vibraciones</a>
                                <a href="industria.html#servicio-modelacion-vibraciones">Modelación de vibraciones</a>
                                <a href="industria.html#servicio-modelacion-ruido-subacuatico">Modelación de ruido subacuático</a>
                                <a href="industria.html#servicio-medicion-ruido-subacuatico">Medición de ruido subacuático</a>
                                <a href="industria.html#servicio-geoespacial">Analítica geoespacial</a>
                                <a href="industria.html#servicio-fotogrametria">Fotogrametría</a>
                            </div>
                        </li>
                        <li><a href="#">Infraestructura</a></li>
                    </ul>
                </li>
                <li class="nav-dropdown active">
                    <button type="button" class="nav-dropdown-toggle" aria-expanded="false" aria-haspopup="true">Proyectos</button>
                    <ul class="nav-dropdown-menu">
                        <li><a href="ciudades-proyectos.html">Ciudades</a></li>
                        <li><a href="industria-proyectos.html">Industria</a></li>
                        <li><a href="#">Infraestructura</a></li>
                    </ul>
                </li>
                <li><a href="about.html">Nosotros</a></li>
                <li><a href="blog.html">Blog</a></li>
                <li><a href="contacto.html">Contacto</a></li>
            </ul>
            <div class="nav-actions">
                <div class="nav-theme-wrap">
                    <button type="button" class="nav-theme-btn" id="theme-toggle" aria-label="Usar modo oscuro" title="Modo oscuro">
                        <span class="nav-theme-icon nav-theme-icon-sun" aria-hidden="true"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="20" height="20"><circle cx="12" cy="12" r="4"/><path d="M12 2v2M12 20v2M4.93 4.93l1.41 1.41M17.66 17.66l1.41 1.41M2 12h2M20 12h2M6.34 17.66l-1.41 1.41M19.07 4.93l-1.41 1.41"/></svg></span>
                        <span class="nav-theme-icon nav-theme-icon-moon" aria-hidden="true" hidden><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="20" height="20"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg></span>
                    </button>
                </div>
                <button type="button" class="nav-hamburger" id="nav-hamburger" aria-label="Abrir menú" aria-expanded="false" aria-controls="nav-links">
                    <span class="nav-hamburger-bar"></span>
                    <span class="nav-hamburger-bar"></span>
                    <span class="nav-hamburger-bar"></span>
                </button>
            </div>
        </div>
    </nav>

    <main class="proyectos-page">
        <div class="proyectos-hero-bg" aria-hidden="true"></div>
        <div class="proyectos-hero-overlay" aria-hidden="true"></div>
        
        <div class="proyectos-filters-container">
            <div class="proyectos-tags-top" role="tablist">
                <button type="button" class="proyectos-tag active" data-servicio="iot" role="tab">IoT</button>
                <button type="button" class="proyectos-tag" data-servicio="mapas-ruido" role="tab">Mapas de ruido</button>
                <button type="button" class="proyectos-tag" data-servicio="webgis" role="tab">Ecosistemas WEBGIS</button>
                <button type="button" class="proyectos-tag" data-servicio="descontaminacion" role="tab">Descontaminación acústica</button>
                <button type="button" class="proyectos-tag" data-servicio="geoespacial" role="tab">Analítica geoespacial</button>
            </div>
            <div class="proyectos-search-bar">
                <svg class="search-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="11" cy="11" r="8"/>
                    <path d="m21 21-4.35-4.35"/>
                </svg>
                <input type="search" class="search-input" placeholder="Buscar proyectos..." aria-label="Buscar proyectos">
            </div>
        </div>
        
        <div class="proyectos-content">
            <div class="proyectos-left">
                <a href="industria-proyectos.html" class="proyectos-service-nav proyectos-service-next" aria-label="Ir a Industria">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14"/><path d="m12 5 7 7-7 7"/></svg>
                </a>
                <div class="proyectos-title-section">
                    <span class="proyectos-location">Colombia</span>
                    <h1 class="proyectos-title">CIUDADES</h1>
                    <p class="proyectos-description">Desarrollo y gestión inteligente de espacios urbanos. Soluciones geoespaciales para ciudades sostenibles y conectadas.</p>
                </div>
            </div>

            <div class="proyectos-right">
                <div class="proyectos-cards-container">
                    <button type="button" class="carousel-btn carousel-prev" aria-label="Anterior">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M15 18l-6-6 6-6"/></svg>
                    </button>
                    <div class="proyectos-carousel">
                        <p class="proyectos-empty-message" id="ciudades-empty-message" style="display: none;" aria-live="polite">No hay proyectos disponibles</p>
                        <div class="carousel-track" id="ciudades-carousel-track">
                            <article class="proyecto-card proyecto-card-amva-usb" data-servicios="iot webgis" data-proyecto="amva-usb" style="display: none;"
                                data-proyecto-img="../proyectos/ciudades/AMVA-USB/IMG_4278.jpeg"
                                data-proyecto-titulo="AMVA-USB"
                                data-proyecto-desc="Monitoreo urbano y soluciones geoespaciales para el Área Metropolitana"
                                data-proyecto-desc-long="Monitoreo urbano y soluciones geoespaciales para el Área Metropolitana del Valle de Aburrá (AMVA), incluyendo mediciones ambientales, mapas de ruido, sensores IoT y plataformas de información territorial para la gestión de ciudades inteligentes. Integración de datos en tiempo real, analítica geoespacial y acústica para apoyar la toma de decisiones y el cumplimiento normativo en entornos urbanos."
                                data-proyecto-categoria="ciudades"
                                data-proyecto-ano="2024"
                                data-proyecto-cliente="AMVA">
                                <div class="proyecto-card-link-wrap" role="button" tabindex="0" aria-label="Ver detalle AMVA-USB">
                                    <div class="proyecto-card-img" style="background-image: url('../proyectos/ciudades/AMVA-USB/IMG_4278.jpeg');"></div>
                                    <div class="proyecto-card-content">
                                        <h3 class="proyecto-card-title">AMVA-USB</h3>
                                        <p class="proyecto-card-desc">Monitoreo urbano y soluciones geoespaciales para el Área Metropolitana</p>
                                    </div>
                                </div>
                            </article>
                        </div>
                    </div>
                    <button type="button" class="carousel-btn carousel-next" aria-label="Siguiente">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 18l6-6-6-6"/></svg>
                    </button>
                </div>
            </div>
        </div>

        <!-- Panel de detalle: se despliega desde la derecha; izquierda = carrusel de imágenes del proyecto -->
        <div class="proyecto-panel" id="proyecto-panel" aria-hidden="true">
            <div class="proyecto-panel-inner">
                <button type="button" class="proyecto-panel-close" id="proyecto-panel-close" aria-label="Cerrar panel">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6L6 18M6 6l12 12"/></svg>
                </button>
                <div class="proyecto-panel-image-wrap">
                    <div class="proyecto-panel-carousel-wrap">
                        <button type="button" class="proyecto-panel-carousel-prev" id="proyecto-panel-carousel-prev" aria-label="Imagen anterior">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M15 18l-6-6 6-6"/></svg>
                        </button>
                        <div class="proyecto-panel-carousel-track" id="proyecto-panel-carousel-track">
                            <!-- Imágenes del proyecto se inyectan por JS -->
                        </div>
                        <button type="button" class="proyecto-panel-carousel-next" id="proyecto-panel-carousel-next" aria-label="Siguiente imagen">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 18l6-6-6-6"/></svg>
                        </button>
                    </div>
                </div>
                <div class="proyecto-panel-content">
                    <h2 id="proyecto-panel-title" class="proyecto-panel-title"></h2>
                    <div class="proyecto-panel-meta">
                        <p class="proyecto-panel-meta-item">Categoría: <span id="proyecto-panel-categoria"></span></p>
                        <p class="proyecto-panel-meta-item">Año: <span id="proyecto-panel-ano"></span></p>
                        <p class="proyecto-panel-meta-item">Cliente: <span id="proyecto-panel-cliente"></span></p>
                    </div>
                    <p class="proyecto-panel-label">Descripción del proyecto</p>
                    <p id="proyecto-panel-desc" class="proyecto-panel-desc"></p>
                </div>
            </div>
        </div>
        <div class="proyecto-panel-backdrop" id="proyecto-panel-backdrop" aria-hidden="true"></div>

    </main>

    <script src="data/amva-usb-images.js"></script>
    <script>
        (function() {
            // Proyectos: tags se deslizan y texto izquierda aparece al entrar en vista
            var page = document.querySelector('.proyectos-page');
            if (page) {
                var animated = false;
                var observer = new IntersectionObserver(function(entries) {
                    entries.forEach(function(entry) {
                        if (entry.isIntersecting && !animated) {
                            animated = true;
                            page.classList.add('proyectos-animated');
                        }
                    });
                }, { rootMargin: '0px', threshold: 0.1 });
                observer.observe(page);
            }

            var params = new URLSearchParams(window.location.search);
            var servicio = params.get('servicio') || 'iot';
            var tagMap = { iot: 0, 'mapas-ruido': 1, webgis: 2, descontaminacion: 3, geoespacial: 4 };
            var tags = document.querySelectorAll('.proyectos-tag');
            var idx = tagMap[servicio] !== undefined ? tagMap[servicio] : 0;
            tags.forEach(function(t, i) { t.classList.toggle('active', i === idx); });

            var amvaCard = document.querySelector('.proyecto-card-amva-usb');
            var emptyMsg = document.getElementById('ciudades-empty-message');
            var carouselTrack = document.getElementById('ciudades-carousel-track');
            function toggleCiudadesCards() {
                var activeTag = document.querySelector('.proyectos-tag.active');
                var s = activeTag ? (activeTag.getAttribute('data-servicio') || '').trim() : '';
                var showAmva = s === 'iot' || s === 'webgis';
                var hasAnyProject = showAmva;
                if (amvaCard) amvaCard.style.display = showAmva ? 'block' : 'none';
                if (emptyMsg) emptyMsg.style.display = hasAnyProject ? 'none' : 'flex';
                if (carouselTrack) carouselTrack.style.display = hasAnyProject ? 'flex' : 'none';
            }
            toggleCiudadesCards();

            tags.forEach(function(btn) {
                btn.addEventListener('click', function() {
                    tags.forEach(function(t) { t.classList.remove('active'); });
                    btn.classList.add('active');
                    var s = btn.getAttribute('data-servicio');
                    var url = new URL(window.location.href);
                    url.searchParams.set('servicio', s);
                    window.history.replaceState({}, '', url);
                    toggleCiudadesCards();
                });
            });

            var track = document.querySelector('.carousel-track');
            var prev = document.querySelector('.carousel-prev');
            var next = document.querySelector('.carousel-next');
            var cardWidth = 320; // Ancho fijo de las cards
            var gap = 20; // Gap entre cards

            function go(delta) {
                if (!track) return;
                var scrollAmount = (cardWidth + gap) * delta;
                track.scrollBy({ left: scrollAmount, behavior: 'smooth' });
            }

            if (prev) prev.addEventListener('click', function() { go(-1); });
            if (next) next.addEventListener('click', function() { go(1); });

            /* Panel de detalle: abrir al hacer clic en una card; izquierda = carrusel de imágenes del proyecto */
            var page = document.querySelector('.proyectos-page');
            var panel = document.getElementById('proyecto-panel');
            var backdrop = document.getElementById('proyecto-panel-backdrop');
            var closeBtn = document.getElementById('proyecto-panel-close');
            var panelCarouselTrack = document.getElementById('proyecto-panel-carousel-track');
            var panelCarouselPrev = document.getElementById('proyecto-panel-carousel-prev');
            var panelCarouselNext = document.getElementById('proyecto-panel-carousel-next');
            var panelTitle = document.getElementById('proyecto-panel-title');
            var panelCategoria = document.getElementById('proyecto-panel-categoria');
            var panelAno = document.getElementById('proyecto-panel-ano');
            var panelCliente = document.getElementById('proyecto-panel-cliente');
            var panelDesc = document.getElementById('proyecto-panel-desc');

            var panelCarouselIndex = 0;
            var panelCarouselImages = [];

            function buildPanelCarousel(proyectoId, titulo) {
                if (!panelCarouselTrack) return;
                panelCarouselTrack.innerHTML = '';
                panelCarouselImages = [];
                var images = [];
                var base = '';
                if (proyectoId === 'amva-usb' && typeof AMVA_USB_IMAGES !== 'undefined' && AMVA_USB_IMAGES.length) {
                    images = AMVA_USB_IMAGES;
                    base = '../proyectos/ciudades/AMVA-USB/';
                }
                if (images.length === 0) return;
                panelCarouselImages = images.map(function(f) { return base + f; });
                var wrap = panelCarouselTrack.closest('.proyecto-panel-carousel-wrap');
                if (wrap) wrap.classList.toggle('multiple', panelCarouselImages.length > 1);
                panelCarouselImages.forEach(function(src, i) {
                    var slide = document.createElement('div');
                    slide.className = 'proyecto-panel-carousel-slide' + (i === 0 ? ' active' : '');
                    var img = document.createElement('img');
                    img.src = src;
                    img.alt = titulo + ' - Imagen ' + (i + 1);
                    img.className = 'proyecto-panel-img';
                    slide.appendChild(img);
                    panelCarouselTrack.appendChild(slide);
                });
                panelCarouselIndex = 0;
            }

            function goPanelCarousel(delta) {
                if (panelCarouselImages.length <= 1) return;
                var slides = panelCarouselTrack ? panelCarouselTrack.querySelectorAll('.proyecto-panel-carousel-slide') : [];
                if (slides.length === 0) return;
                slides[panelCarouselIndex].classList.remove('active');
                panelCarouselIndex = (panelCarouselIndex + delta + slides.length) % slides.length;
                slides[panelCarouselIndex].classList.add('active');
            }

            function openProyectoPanel() {
                if (page) page.classList.add('proyecto-panel-open');
                document.body.classList.add('proyecto-panel-open');
                if (panel) { panel.setAttribute('aria-hidden', 'false'); }
                if (backdrop) { backdrop.setAttribute('aria-hidden', 'false'); }
            }
            function closeProyectoPanel() {
                if (page) page.classList.remove('proyecto-panel-open');
                document.body.classList.remove('proyecto-panel-open');
                if (panel) { panel.setAttribute('aria-hidden', 'true'); }
                if (backdrop) { backdrop.setAttribute('aria-hidden', 'true'); }
            }

            document.querySelectorAll('.proyecto-card').forEach(function(card) {
                var linkWrap = card.querySelector('.proyecto-card-link-wrap');
                if (!linkWrap) return;
                linkWrap.addEventListener('click', function(e) {
                    e.preventDefault();
                    var proyectoId = card.getAttribute('data-proyecto') || '';
                    var titulo = card.getAttribute('data-proyecto-titulo') || '';
                    var desc = card.getAttribute('data-proyecto-desc-long') || card.getAttribute('data-proyecto-desc') || '';
                    var categoria = card.getAttribute('data-proyecto-categoria') || '';
                    var ano = card.getAttribute('data-proyecto-ano') || '';
                    var cliente = card.getAttribute('data-proyecto-cliente') || '';
                    buildPanelCarousel(proyectoId, titulo);
                    if (panelTitle) panelTitle.textContent = titulo;
                    if (panelCategoria) panelCategoria.textContent = categoria;
                    if (panelAno) panelAno.textContent = ano;
                    if (panelCliente) panelCliente.textContent = cliente;
                    if (panelDesc) panelDesc.textContent = desc;
                    openProyectoPanel();
                });
                linkWrap.addEventListener('keydown', function(e) {
                    if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); linkWrap.click(); }
                });
            });

            if (panelCarouselPrev) panelCarouselPrev.addEventListener('click', function() { goPanelCarousel(-1); });
            if (panelCarouselNext) panelCarouselNext.addEventListener('click', function() { goPanelCarousel(1); });
            if (closeBtn) closeBtn.addEventListener('click', closeProyectoPanel);
            if (backdrop) backdrop.addEventListener('click', closeProyectoPanel);

            /* Abrir panel al llegar desde inicio con ?proyecto=amva-usb */
            var openParams = new URLSearchParams(window.location.search);
            var openProyectoId = openParams.get('proyecto');
            if (openProyectoId === 'amva-usb' && amvaCard) {
                var tagIoT = document.querySelector('.proyectos-tag[data-servicio="iot"]');
                if (tagIoT) { tags.forEach(function(t) { t.classList.remove('active'); }); tagIoT.classList.add('active'); }
                toggleCiudadesCards();
                setTimeout(function() {
                    var titulo = amvaCard.getAttribute('data-proyecto-titulo') || '';
                    var desc = amvaCard.getAttribute('data-proyecto-desc-long') || amvaCard.getAttribute('data-proyecto-desc') || '';
                    var categoria = amvaCard.getAttribute('data-proyecto-categoria') || '';
                    var ano = amvaCard.getAttribute('data-proyecto-ano') || '';
                    var cliente = amvaCard.getAttribute('data-proyecto-cliente') || '';
                    buildPanelCarousel('amva-usb', titulo);
                    if (panelTitle) panelTitle.textContent = titulo;
                    if (panelCategoria) panelCategoria.textContent = categoria;
                    if (panelAno) panelAno.textContent = ano;
                    if (panelCliente) panelCliente.textContent = cliente;
                    if (panelDesc) panelDesc.textContent = desc;
                    openProyectoPanel();
                }, 100);
            }
        })();
    </script>
    <script>
        document.querySelectorAll('.nav-dropdown-toggle').forEach(function(btn) {
            btn.addEventListener('click', function(e) {
                e.preventDefault();
                var parent = this.closest('.nav-dropdown');
                var isOpen = parent.classList.contains('open');
                document.querySelectorAll('.nav-dropdown').forEach(function(d) { d.classList.remove('open'); });
                if (!isOpen) parent.classList.add('open');
                btn.setAttribute('aria-expanded', !isOpen);
            });
        });
        document.addEventListener('click', function(e) {
            if (!e.target.closest('.nav-dropdown')) {
                document.querySelectorAll('.nav-dropdown').forEach(function(d) { d.classList.remove('open'); });
                document.querySelectorAll('.nav-dropdown-toggle').forEach(function(b) { b.setAttribute('aria-expanded', 'false'); });
            }
        });
    </script>
    <script src="../js/nav.js"></script>
    <script src="../js/theme.js"></script>
</body>
</html>
